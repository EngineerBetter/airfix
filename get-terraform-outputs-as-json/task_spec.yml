---
config: task.yml
cases:
- when: invoked with normal statefile
  it: # writes outputs from terraform as flattened JSON
    exits: 0
    has_inputs:
    - name: state
      from: fixtures/state
    has_outputs: &has_outputs
    - name: outputs
      for_which:
      - bash: cat terraform.json | jq -c '.example_output'
        says:
        - '["a","b","c"]'
      - bash: cat terraform.json | jq -c '.example_sensitive_output'
        says:
        - very secret key

- when: invoked with a different statefile
  it: # writes outputs from terraform as flattened JSON
    exits: 0
    has_inputs:
    - name: state
      from: fixtures/different-statefile
    has_outputs: *has_outputs
  params:
    STATEFILE: different-statefile-name.tfstate

- when: invoked with a statefile containing invalid JSON
  it:
    exits: 5
    has_inputs:
    - name: state
      from: fixtures/bad-statefile

- when: invoked with a statefile that does not exist
  it:
    exits: 1
    has_inputs:
    - name: state
      setup: |
        touch notthestate.tfstate
