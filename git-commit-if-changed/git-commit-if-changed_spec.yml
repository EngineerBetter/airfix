---
config: git-commit-if-changed.yml
enclosed_in_input: { name: this, path_relative_to_spec: ../ }
cases:
- when: there is no change
  it:
    exits: 0
    has_inputs:
    - name: input
      setup: |
        git init
        touch foo
        git add foo
        git commit -m "initial commit"
- when: there is an uncommitted change
  it: # commits the change
    exits: 0
    has_outputs:
    - name: output
      for_which:
      - { bash: git status, exits: 0, says: ["nothing to commit, working tree clean"] }
      - { bash: git show HEAD, exits: 0, says: ["Author: Lesley <test@example.com>", "automated commit"] }
    has_inputs:
    - name: input
      setup: |
        git init
        touch foo
        git add foo
        git commit -m "initial commit"
        echo bar > foo
  params:
    GIT_AUTHOR_EMAIL: test@example.com
    GIT_AUTHOR_NAME: Lesley
    GIT_COMMIT_MESSAGE: automated commit
